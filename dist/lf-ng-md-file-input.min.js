!function(e){"use strict";var i=function(){return"lfobjxxxxxxxx".replace(/[xy]/g,function(e){var i=16*Math.random()|0,n="x"==e?i:3&i|8;return n.toString(16)})},n=e.module("lfNgMdFileInput",["ngMaterial"]);n.filter("lfTrusted",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),n.directive("lfRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,t){t&&(t.$validators.required=function(e,i){return e?e.length>0:!1})}}}),n.directive("lfMaxcount",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,t){if(t){var l=-1;n.$observe("lfMaxcount",function(e){var i=parseInt(e,10);l=isNaN(i)?-1:i,t.$validate()}),t.$validators.maxcount=function(e,i){return e?e.length<=l:!1}}}}}),n.directive("lfFilesize",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,t){if(t){var l=-1;n.$observe("lfFilesize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var n=["Byte","KB","MB"],r=e.match(i)[1],o=e.substring(0,e.indexOf(r));n.every(function(e,i){return r===e?(l=parseInt(o)*Math.pow(1024,i),!1):!0})}else l=-1;t.$validate()}),t.$validators.filesize=function(e,i){if(!e)return!1;var n=!0;return e.every(function(e,i){return e.lfFile.size>l?(n=!1,!1):!0}),n}}}}}),n.directive("lfTotalsize",function(){return{restrict:"A",require:"ngModel",link:function(i,n,t,l){if(l){var r=-1;t.$observe("lfTotalsize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var n=["Byte","KB","MB"],t=e.match(i)[1],o=e.substring(0,e.indexOf(t));n.every(function(e,i){return t===e?(r=parseInt(o)*Math.pow(1024,i),!1):!0})}else r=-1;l.$validate()}),l.$validators.totalsize=function(i,n){if(!i)return!1;var t=0;return e.forEach(i,function(e,i){t+=e.lfFile.size}),r>t}}}}}),n.directive("lfMimetype",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,t){if(t){var l;n.$observe("lfMimetype",function(e){l=new RegExp(e,"i"),t.$validate()}),t.$validators.mimetype=function(e,i){if(!e)return!1;var n=!0;return e.every(function(e,i){return e.lfFile.type.match(l)?!0:(n=!1,!1)}),n}}}}}),n.directive("lfNgMdFileInput",["$q","$compile","$timeout",function(n,t,l){return{restrict:"E",template:['<div layout="column" class="lf-ng-md-file-input" ng-model="'+i()+'">','<div layout="column" class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':isDisabled}" ng-show="isDrag || (isPreview && !isFilesNull)">','<div class="close lf-ng-md-file-input-x" ng-click="removeAllFiles($event)" ng-hide="isFilesNull" >&times;</div>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="isFilesNull && isDrag">','<div class="lf-ng-md-file-input-drag-text">{{strCaptionDragAndDrop}}</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails">',"</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div layout="row" class="lf-ng-md-file-input-container" >','<div class="lf-ng-md-file-input-caption" layout="row" layout-align="start center" flex ng-class="{\'disabled\':isDisabled}" >','<md-icon class="lf-icon" ng-class="strCaptionIconCls"></md-icon>','<div flex class="lf-ng-md-file-input-caption-text-default" ng-show="isFilesNull">',"{{strCaptionPlaceholder}}","</div>",'<div flex class="lf-ng-md-file-input-caption-text" ng-hide="isFilesNull">',"{{strCaption}}","</div>",'<md-progress-linear md-mode="determinate" value="{{floatProgress}}" ng-show="intLoading && isProgress"></md-progress-linear>',"</div>",'<md-button ng-disabled="isDisabled" ng-click="removeAllFiles()" ng-hide="isFilesNull || intLoading" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove" >','<md-icon class="lf-icon" ng-class="strRemoveIconCls"></md-icon> ',"{{strCaptionRemove}}","</md-button>",'<md-button ng-disabled="isDisabled" ng-click="openDialog($event, this)" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower" >','<md-icon class="lf-icon" ng-class="strBrowseIconCls"></md-icon> ',"{{strCaptionBrowse}}",'<input type="file" aria-label="{{strAriaLabel}}" accept="{{accept}}" ng-disabled="isDisabled" class="lf-ng-md-file-input-tag" />',"</md-button>","</div>","</div>"].join(""),replace:!0,require:"ngModel",scope:{lfFiles:"=?",lfApi:"=?",lfOption:"=?",lfCaption:"@?",lfPlaceholder:"@?",lfDragAndDropLabel:"@?",lfBrowseLabel:"@?",lfRemoveLabel:"@?",accept:"@?",ngDisabled:"=?"},link:function(i,r,o,a){var s=e.element(r[0].querySelector(".lf-ng-md-file-input-tag")),f=e.element(r[0].querySelector(".lf-ng-md-file-input-drag")),c=e.element(r[0].querySelector(".lf-ng-md-file-input-thumbnails")),d=!1,u=0;i.intLoading=0,i.floatProgress=0,i.isPreview=!1,i.isDrag=!1,i.isMutiple=!1,i.isProgress=!1,e.isDefined(o.preview)&&(i.isPreview=!0),e.isDefined(o.drag)&&(i.isDrag=!0),e.isDefined(o.multiple)?(s.attr("multiple","multiple"),i.isMutiple=!0):s.removeAttr("multiple"),e.isDefined(o.progress)&&(i.isProgress=!0),i.isDisabled=!1,e.isDefined(o.ngDisabled)&&i.$watch("ngDisabled",function(e){i.isDisabled=e}),i.strBrowseIconCls="lf-browse",i.strRemoveIconCls="lf-remove",i.strCaptionIconCls="lf-caption",i.strUnknowIconCls="lf-unknow",e.isDefined(o.lfOption)&&e.isObject(i.lfOption)&&(i.lfOption.hasOwnProperty("browseIconCls")&&(i.strBrowseIconCls=i.lfOption.browseIconCls),i.lfOption.hasOwnProperty("removeIconCls")&&(i.strRemoveIconCls=i.lfOption.removeIconCls),i.lfOption.hasOwnProperty("captionIconCls")&&(i.strCaptionIconCls=i.lfOption.captionIconCls),i.lfOption.hasOwnProperty("unknowIconCls")&&(i.strUnknowIconCls=i.lfOption.unknowIconCls)),i.accept=i.accept||"",i.lfFiles=[],i[o.ngModel]=i.lfFiles,i.$watch("lfFiles.length",function(e,i){a.$validate()}),i.lfApi=new function(){var e=this;e.removeAll=function(){i.removeAllFiles()}},i.isFilesNull=!0,i.strCaption="",i.strCaptionPlaceholder="Select file",i.strCaptionDragAndDrop="Drag & drop files here...",i.strCaptionBrowse="Browse",i.strCaptionRemove="Remove",i.strAriaLabel="",e.isDefined(o.ariaLabel)&&(i.strAriaLabel=o.ariaLabel),e.isDefined(o.lfPlaceholder)&&i.$watch("lfPlaceholder",function(e){i.strCaptionPlaceholder=e}),e.isDefined(o.lfCaption)&&(d=!0,i.$watch("lfCaption",function(e){i.strCaption=e})),i.lfDragAndDropLabel&&(i.strCaptionDragAndDrop=i.lfDragAndDropLabel),i.lfBrowseLabel&&(i.strCaptionBrowse=i.lfBrowseLabel),i.lfRemoveLabel&&(i.strCaptionRemove=i.lfRemoveLabel),f.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),!i.isDisabled&&i.isDrag&&f.addClass("lf-ng-md-file-input-drag-hover")}),f.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),!i.isDisabled&&i.isDrag&&f.removeClass("lf-ng-md-file-input-drag-hover")}),f.bind("drop",function(n){if(n.stopPropagation(),n.preventDefault(),!i.isDisabled&&i.isDrag){f.removeClass("lf-ng-md-file-input-drag-hover"),e.isObject(n.originalEvent)&&(n=n.originalEvent);var t,l=n.target.files||n.dataTransfer.files,r=0;if(!(l.length<=0)){var o=i.lfFiles.map(function(e){return e.lfFileName}),a=new RegExp(i.accept,"i");if(i.floatProgress=0,i.isMutiple)for(u=l.length,r=0;r<l.length;r++)t=l[r],t.type.match(a)&&-1==o.indexOf(t.name)&&setTimeout(p(t),100*r);else for(u=1,r=0;r<l.length;r++)if(t=l[r],t.type.match(a)&&-1==o.indexOf(t.name)){i.removeAllFiles(),setTimeout(p(t),100*r);break}}}}),i.openDialog=function(e,i){e&&l(function(){e.preventDefault(),e.stopPropagation();var i=e.target.children[2];void 0!==i&&i.click()},0)},i.removeAllFiles=function(e){i.isDisabled||(i.lfFiles.length=0,c.empty(),g())},i.removeFileByName=function(n,t){i.isDisabled||(i.lfFiles.every(function(e,t){return e.lfFileName==n?(i.lfFiles.splice(t,1),!1):!0}),t&&e.element(t.target).parent().remove(),g())},i.onFileChanged=function(e){var n=e.files||e.target.files,t=i.lfFiles.map(function(e){return e.lfFileName});if(!(n.length<=0)){if(i.floatProgress=0,i.isMutiple){u=n.length;for(var l=0;l<n.length;l++){var r=n[l],o=1;-1==t.indexOf(r.name)&&(setTimeout(p(r),100*o),o++)}}else{u=1;for(var l=0;l<n.length;l++){var r=n[l];if(-1==t.indexOf(r.name)){i.removeAllFiles(),setTimeout(p(r),100);break}}}s.val("")}},s.bind("change",i.onFileChanged);var p=function(n){i.intLoading++,w(n).then(function(l){var r=n,o=n.name,a=n.type,s=m(n),f=window.URL.createObjectURL(n);i.lfFiles.push({lfFile:r,lfFileName:o,lfDataUrl:f});var d=e.element('<div class="lf-ng-md-file-input-frame"></div>'),u=e.element('<div class="lf-ng-md-file-input-x" ng-click="removeFileByName(\''+n.name+"',$event)\">&times;</div>"),p="";p="image"==s?'<img src="'+f+'" >':"video"==s?["<video controls>",'<source src="'+f+'" type="'+a+'">',"</video>"].join(""):"audio"==s?["<audio controls>",'<source src="'+f+'" type="'+a+'">',"</audio>"].join(""):['<object data="'+f+'" type="'+a+'"><param name="movie" value="'+r.name+'" />','<div class="lf-ng-md-file-input-preview-default">','<md-icon class="lf-ng-md-file-input-preview-icon" ng-class="strUnknowIconCls"></md-icon>',"</div>","</object>"].join("");var v=e.element(p),b=e.element('<div class="lf-ng-md-file-input-frame-footer"><div class="lf-ng-md-file-input-frame-caption">'+r.name+"</div></div>");d.append(u),d.append(v),d.append(b),t(d)(i),c.append(d),g()},function(e){},function(e){})},g=function(){1==i.lfFiles.length?(d||(i.strCaption=""+i.lfFiles[0].lfFileName),i.isFilesNull=!1):i.lfFiles.length>1?(d||(i.strCaption=""+i.lfFiles.length+" files selected"),i.isFilesNull=!1):(d||(i.strCaption=""),i.isFilesNull=!0)},m=function(e){var i=e.type,n=e.name;return v(i,n)?"image":b(i,n)?"video":h(i,n)?"audio":"object"},v=function(e,i){return e.match("image.*")||i.match(/\.(gif|png|jpe?g)$/i)?!0:!1},b=function(e,i){return e.match("video.*")||i.match(/\.(og?|mp4|webm|3gp)$/i)?!0:!1},h=function(e,i){return e.match("audio.*")||i.match(/\.(ogg|mp3|wav)$/i)?!0:!1},w=function(e,t){var l=n.defer(),r=new FileReader;return r.onloadstart=function(){l.notify(0)},r.onload=function(e){},r.onloadend=function(e){l.resolve({index:t,result:r.result}),i.intLoading--,i.floatProgress=(u-i.intLoading)/u*100},r.onerror=function(e){l.reject(r.result),i.intLoading--,i.floatProgress=(u-i.intLoading)/u*100},r.onprogress=function(e){l.notify(e.loaded/e.total)},r.readAsArrayBuffer(e),l.promise}}}}])}(window.angular);